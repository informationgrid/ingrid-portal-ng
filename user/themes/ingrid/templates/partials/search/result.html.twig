{# @var search_result \Grav\Plugin\SearchResult #}

<div class="results-index">
    <div class="row">
        {% include 'partials/search/result/result_counter.html.twig' %}
    </div>
</div>
<div class="filters-active">
    <form action="{{ page.find('/search').url }}?{{ uri.query }}" method="post" name="removeFacet" id="removeFacet">
        <input type="hidden" name="removeFacet" value="true" />
        {% for facet, values in selected_facets %}
            {% if facet == 'bbox' %}
                <button type="submit" id="{{ facet }}" class="button pill" name="{{ facet }}" value="{{ facet }}">
                    Raumbezug: {{ value }}
                    <span class="ic-ic-cross"></span>
                </button>
            {% endif %}
            {% for facetItem in values | split(',') %}
                {% set actionLink = "" %}
                {# find action link for selected facet #}
                {% for item in search_result.facets %}
                    {% for bucket in item.items %}
                        {% if bucket.value == facetItem %}
                            {% set actionLink = bucket.actionLink %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}

                <a href="{{ actionLink }}" id="{{ facet }}" class="button pill">
                    {{ ('facet-label.' ~ facet) | t}}: {{ (facet ~ '.' ~ facetItem) | t }}
                    <span class="ic-ic-cross"></span>
                </a>
            {% endfor %}
        {% endfor %}
        {% if selected_facets|length > 0 %}
            <a type="reset" href="{{ page.find('/search').url }}?q={{ uri.query('q') }}" class="button pill">
                Alle Einschränkungen löschen
            </a>
        {% endif %}
    </form>
</div>

{% if search_result.hits|length > 0 %}
    {% for hit in search_result.hits %}
        {% if in_array('address', hit.datatypes) %}
            {% include 'partials/search/result/address/result_address.html.twig' with {hit:hit, counter: loop.index0} %}
        {% elseif in_array('www', hit.datatypes) %}
            {% include 'partials/search/result/www/result_www.html.twig' with {hit:hit} %}
        {% else %}
            {% include 'partials/search/result/metadata/result_metadata.html.twig' with {hit:hit, counter: loop.index0} %}
        {% endif %}
  {% endfor %}
  {% include 'partials/search/result/result_counter_bottom.html.twig' %}
{% else %}
    <p><strong>{{ "COMMON.RESULT_NORESULTS"|t }}</strong><br /><br /></p>
{% endif %}
